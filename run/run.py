import sys
from UtilityTools.python.RootNtupleTools import RootNtupleWriterTool
from Services.python.IncidentService import IncidentService, Incident
from DigitRecog.python.DigitRecog import FeX, GaussianBlurTool, CannyEdgeTool, FloatVector


def _run(tool):

  inc_svc = IncidentService.getInstance()
  inc_svc.fireIncident(Incident("BeginRun"))

  
  inc_svc.fireIncident(Incident("BeginEvent"))
  
  digit_class = 8
  img = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,18,18,93,136,172,255,254,249,66,0,0,0,95,16,0,0,0,0,0,0,0,0,0,0,0,0,0,107,253,253,253,253,253,253,253,253,242,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,187,253,248,200,118,82,82,82,225,253,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,225,253,141,0,0,0,0,0,130,253,122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,253,112,0,0,0,0,0,89,253,206,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,107,253,216,0,0,0,0,0,12,253,206,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,107,253,230,0,0,0,0,59,185,253,146,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,107,253,243,53,0,8,124,243,252,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,90,252,253,94,10,161,253,235,146,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,243,253,205,195,253,203,109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,151,253,253,253,158,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,125,253,253,159,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,149,242,253,253,183,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,205,248,239,124,205,224,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,177,253,133,0,0,160,253,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,146,253,173,10,0,5,177,253,154,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,147,253,235,35,58,69,190,253,210,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,113,253,253,239,201,247,253,253,253,155,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,136,253,253,253,253,253,204,141,35,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,207,253,165,135,86,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
  img_vec = FloatVector(img)
  
  tool.execute(digit_class, img_vec)
  
  inc_svc.fireIncident(Incident("EndEvent"))
  
  
  img = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,121,121,121,233,253,199,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68,128,240,253,252,252,252,252,198,95,240,240,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,194,238,252,253,252,252,252,252,246,244,252,252,119,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,252,252,252,253,176,53,107,252,252,252,252,248,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,252,252,252,253,118,0,186,252,252,252,245,106,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,204,252,252,253,168,103,242,252,252,243,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,252,252,253,252,252,252,252,243,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,185,252,253,252,252,252,209,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,14,152,252,253,252,252,252,178,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,252,252,252,253,252,252,139,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,54,253,253,253,253,255,253,253,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,29,208,252,252,252,252,253,252,252,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,233,252,252,252,252,252,253,252,168,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,134,252,252,252,201,106,252,253,252,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,233,252,252,202,94,76,132,252,253,224,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,90,249,252,252,252,66,30,228,252,252,253,118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,121,252,252,252,206,51,144,252,252,252,149,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,108,251,252,252,227,228,252,252,229,93,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,227,250,252,252,242,217,106,45,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,107,189,189,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
  img_vec = FloatVector(img)
  
  inc_svc.fireIncident(Incident("BeginEvent"))
  tool.execute(digit_class, img_vec)
  
  inc_svc.fireIncident(Incident("EndEvent"))

  inc_svc.fireIncident(Incident("EndRun"))

def main():

  print "hello"
  
  
  root_svc = RootNtupleWriterTool("RootTool", "tree.root", "ttree", 3)
  root_svc_meta = RootNtupleWriterTool("RootToolMeta", "tree.root", "ttree_meta", 3)
  
  gauss = GaussianBlurTool()
  canny = CannyEdgeTool()
  
  fex = FeX("myFex", 4, root_svc, root_svc_meta)
  fex.addPreProcessorTool(gauss)
  fex.addPreProcessorTool(canny)
  
  _run(fex)
  
  return 0

if __name__ == '__main__':
    # main should return 0 for success, something else (usually 1) for error.
    sys.exit(main())


